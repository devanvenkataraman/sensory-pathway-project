<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!---------------------- -->
    <!--  React.js and Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <!---------------------- -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css"></link>
    <title>Choose Your Own Adventure! featuring React.js</title>
  </head>
  <body>
    <div class="container-fluid" id="container">If you can read this, it means React is failing.</div>    
    <footer class="text-center bg-warning">
      Devan Venkataraman, 2022
    </footer>
	  
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	  
	  
	  <script type="text/babel">
	  	//Displays status, inventory and Save/Load. Renders in Story.
class HUD extends React.Component{
  constructor(props){
    super(props)
    this.state={
      inventory: props.inventory.map(function(item){
                        return <div><center><button className="inventory-btn" data-toggle="modal" data-target="#Modal">{item[0]}</button><br/><br/></center>
                          <div className="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
                            <div className="modal-dialog" role="document">
                              <div className="modal-content">
                                <div className="modal-header">
                                  <h5 className="modal-title" id="ModalLabel">{item[0]}</h5>
                                </div>
                                <div className="modal-body">
                                  {item[1]}
                                </div>
                                <div className="modal-footer">
                                  <button type="button" className="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                              </div>
                            </div>
                          </div>
                          </div>;
                      })
    }
  }
  
  render(){
    const inv = <center><ul id="inventory" className="pb-1">{this.state.inventory}</ul></center>;
    const invEmpty = <center><p>You have no items</p></center>;
    return(
      <div className="py-2 sticky-top">
        <div class="nav flex-column">
          <center>
            <b>Status</b>
            <br/>
            You are on your way to the final stages of interpretation
            <br/><br/>
            <center><b>Word Bank</b></center>
            {this.state.inventory.length>0 ? inv : invEmpty}
            <button className="p-2 btn btn-block" onClick={() => this.props.saveGame()}>Save</button>
          </center>
        </div>
      </div>
    )
  }
}

//Chapters: render in Story
class ChapterOne extends React.Component{
  constructor(props){
    super(props);
  }
  
  render(){
    const part0 = <p>Let's set the stage: you are an apple growing on a tree in late October... othewise known as prime apple-picking season - yikes. Even worse, an apple-collecting girl looks like she's just about to spot you. She looks up and, sure enough, locks eyes with you. The process of sensation to perception has begun. Let's start you off easy: which sensory pathway will you be "traveling down"?</p>;
    
    const question0 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Auditory pathway</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Visual Pathway</button></p>;
    const part0Bad = <p>Oof. This game might be a little difficult for you. Start over and I have a feeling you'll get this one right on your next try.</p>;
    const part0Good = <p>That's right. Our ability to see and interpret the world around us is made possible biologically by the visual pathway. Now you're ready for your journey.</p>;
    
    const part1 = <p>Your path begins as light enters the eye. But through which part of the eye do you enter?</p>;
    const question1 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Pupil</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Cornea</button></p>;
    const part1Bad = <p>WRONG</p>;
    const part1Good = <p>RIGHT</p>;

    const part2 = <p>Next Q</p>;
    const question2 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>option correct</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>option wrong</button></p>;
    const part2Bad = <p>WRONG again</p>;
    const part2Good = <p>RIGHT again</p>;

    return(
      <p>
        {part0}
        {this.props.progress==0 && question0}
        {this.props.progress>=1 && (this.props.choices[0]==0 ? <p><i>Auditory pathway</i></p> : <p><i>Visual pathway</i></p>)}
        {this.props.progress>=1 && (this.props.choices[0]==1 ? part0Good : part0Bad)}

        {this.props.progress>=1 && (this.props.choices[0]==1 ? part1 : <p></p>)}
        {this.props.progress==1 && (this.props.choices[0]==1 ? question1 : <p>Game over.</p>)}
        {this.props.progress>=2 && (this.props.choices[1]==0 ? <p><i>Pupil</i></p> : <p><i>Cornea</i></p>)}
        {this.props.progress>=2 && (this.props.choices[1]==1 ? part1Bad : part1Good)}

        {this.props.progress>=1 && (this.props.choices[1]==0 ? part2 : <p></p>)}
        {this.props.progress==2 && (this.props.choices[1]==0 ? question2 : <p>Game over.</p>)}
        {this.props.progress>=3 && (this.props.choices[2]==0 ? <p><i>option correct</i></p> : <p><i>option incorrect</i></p>)}
        {this.props.progress>=3 && (this.props.choices[2]==1 ? part2Bad : part2Good)}
      </p>
    )
  }
}


//Parent: Layout and Inventory Data
//Contains the story chapters
class Story extends React.Component{
  constructor(props){
    super(props);
    this.state={
      /* INDEX OF CHOICES:
      0: Start
      */
      choices: [],
      //Progress in general history
      chapter: 0,
      //To advance to the next paragraph.
      progress: 0,
      /*Determines the paragraphs that will appear next depending on your choices
      0: Start
      */
      path: 0,
      //For more complex branching
      subpath: 0,
      inventory: [
        //Name, Description
        ["Will to live", "Without this, you would be dead."]
      ],
      game: false
    };
	  this.startGame = this.startGame.bind(this);
    this.addChoice = this.addChoice.bind(this);
    this.renderIntro_Header = this.renderIntro_Header.bind(this);
    this.renderStory = this.renderStory.bind(this);
  }
  startGame(){
    this.setState({
      game: true
    })
  }
  addChoice(choiceMade){
    let cho = this.state.choices;
    cho.push(choiceMade)
    this.setState({choices: cho, progress: this.state.progress+1});
  }
  saveGame(){
    try{
      localStorage.chapter = this.state.chapter;
      localStorage.progress = this.state.progress;
      localStorage.path = this.state.path;
      localStorage.setItem('choices', JSON.stringify(this.state.choices));
      localStorage.setItem('inventory', JSON.stringify(this.state.inventory));
      alert('Game saved');
    }catch(e){
      alert('Something went wrong!' + e.error);
    }
  }
  loadGame(){
    let cho = JSON.parse(localStorage.getItem('choices'));
    let inv = JSON.parse(localStorage.getItem('inventory'));
    this.setState({
      game: true,
      chapter: localStorage.chapter,
      progress: localStorage.progress,
      path: localStorage.path,
      choices: cho,
      inventory: inv
    })
  }
  
  //Conditionals for rendering
  renderIntro_Header(){
    if(this.state.game==false){
      return(
            <header className="text-center bg-warning jumbotron">
              Sensory Pathway Project
            </header>
     )
    }
  }
  renderStory(){
    if(this.state.progress>=0){
      return(<ChapterOne addChoice={this.addChoice.bind(this)} progress={this.state.progress} choices={this.state.choices} path={this.state.path} subpath={this.state.subpath}/>);
    }
    // else if(this.state.progress>=2 & this.state.progress<=2){
    //   return(<ChapterTwo addChoice={this.addChoice.bind(this)} progress={this.state.progress} choices={this.state.choices} path={this.state.path} subpath={this.state.subpath}/>);
    // }
  }
  ///////////////////////////
  render(){
    return(
      <div>
	    {this.renderIntro_Header()}
      <div className="container-fluid">
        <div className="row">
          {
            this.state.game==true &&
            <nav className="col-3 px-1 bg-info rounded-right" id="sticky-sidebar">
              <HUD inventory={this.state.inventory} saveGame={this.saveGame.bind(this)} loadGame={this.loadGame.bind(this)}/>
            </nav>
          }
          <div className="col-1 col-sm-1 col-md-1 col-xl-1"></div>
          <main className={this.state.game==true ? "col-7 col-sm-7 col-md-7 col-xl-7 py-5" : "col-12 col-sm-12 col-md-12 col-xl-12"}>
            {
              this.state.game==true ?
                this.renderStory()
                :
                <p>Welcome to my Sensory Pathway Project.<br/><br/>
                  For this interactive game I've coded, you will simulate "being" a visual stimulus and track your progress from initial sensation to the final stages of interpretation! To play, simply answer the questions to try and correctly identify steps along the visual pathway. The word bank on the left will not provide the EXACT answers you need, but it will provide some helpful clues along the way! Click on any term to reveal more information. Finally, in this game, there are NO second chances! If you make a wrong selection, you'll have to refresh the page and start over! Get started below and good luck!
                   <br/><br/>
                   <center>
                    <button className="btn" onClick={() => this.startGame()}>Start game</button> <button className="btn" onClick={() => this.loadGame()}>Load Game</button>
                   </center>
                </p>
            }
          </main>
          <div className="col-1 col-sm-1 col-md-1 col-xl-1"></div>
        </div>
      </div>
	  </div>    
    )
  }
}



ReactDOM.render(<Story />, document.getElementById('container'));
	  </script>	
  </body>
</html>
