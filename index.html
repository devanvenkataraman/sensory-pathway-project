<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!---------------------- -->
    <!--  React.js and Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <!---------------------- -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css"></link>
    <title>Choose Your Own Adventure! featuring React.js</title>
  </head>
  <body>
    <div class="container-fluid" id="container">If you can read this, it means React is failing.</div>    
    <footer class="text-center bg-warning">
      Devan Venkataraman, 2022
    </footer>
	  
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	  
	  
	  <script type="text/babel">
	  	//Displays status, inventory and Save/Load. Renders in Story.
class HUD extends React.Component{
  constructor(props){
    super(props)
    this.state={
      inventory: props.inventory.map(function(item){
                        return <div><center><button className="inventory-btn" data-toggle="modal" data-target="#Modal">{item[0]}</button><br/><br/></center>
                          <div className="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
                            <div className="modal-dialog" role="document">
                              <div className="modal-content">
                                <div className="modal-header">
                                  <h5 className="modal-title" id="ModalLabel">{item[0]}</h5>
                                </div>
                                <div className="modal-body">
                                  {item[1]}
                                </div>
                                <div className="modal-footer">
                                  <button type="button" className="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                              </div>
                            </div>
                          </div>
                          </div>;
                      })
    }
  }
  
  render(){
    const inv = <center><ul id="inventory" className="pb-1">{this.state.inventory}</ul></center>;
    const invEmpty = <center><p>You have no items</p></center>;
    return(
      <div className="py-2 sticky-top">
        <div class="nav flex-column">
          <center>
            <b>Status</b>
            <br/>
            You are on your way to the final stages of interpretation
            <br/><br/>
            <center><b>Word Bank</b></center>
            {this.state.inventory.length>0 ? inv : invEmpty}
            <button className="p-2 btn btn-block" onClick={() => this.props.saveGame()}>Save</button>
          </center>
        </div>
      </div>
    )
  }
}

//Chapters: render in Story
class ChapterOne extends React.Component{
  constructor(props){
    super(props);
  }
  
  render(){
    const part0 = <p><b>Let's set the stage: There is an apple growing on a tree in late October, on a beautiful New England orchard. A girl, furiously collecting apples, looks like she's just about to spot the apple. She looks up and, sure enough, locks eyes with it. The process of sensation to perception has begun. Let's start you off easy: which sensory pathway will the apple be "traveling down"?</b></p>;
    
    const question0 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Auditory pathway</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Visual pathway</button></p>;
    const part0Bad = <p>Oof. This game might be a little difficult for you. Start over and I have a feeling you'll get this one right on your next try.</p>;
    const part0Good = <p>That's right. Our ability to see and interpret the world around us is made possible by the visual pathway. Now you're ready for your journey.</p>;
    
    const part1 = <p><b>Your path begins as light enters the eye. But through which part of the eye do you enter?</b></p>;
    const question1 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Pupil</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Iris</button></p>;
    const part1Bad = <p>Not quite. The iris is responsible for regulating the light that enters the eye through contraction and expansion, but light does not actually enter the eye via the iris.</p>;
    const part1Good = <p>That's right, light enters the eye through the pupil. That's exactly why the pupil appears black - it absorbs all light that passes through it! Let's keep moving.</p>;

    const part2 = <p><b>Now the light of the apple has entered the eye. But the journey has just begun! Which part of the eye contains photoreceptors where the process of transduction will take place?</b></p>;
    const question2 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Retina</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Vitreous humor</button></p>;
    const part2Bad = <p>The vitreous humor is fluid that simply fills the chamber in the posterior part of the eye. No transduction occurring here!</p>;
    const part2Good = <p>That's three in a row! Yep, the retina is the site of transduction. But let's not move on from the retina too fast; a lot is going to happen to our apple image here.</p>;

    const part3 = <p><b>You may already know that there are rods and cones located in the retina. Now remember that the girl focused directly on the apple, likely centering it in her gaze. In addition, our scenario is in broad daylight and of course our apple has a vibrant red color, since it's October! Which of these two kinds of photoreceptors is more likely to have processed much of the image?</b></p>;
    const question3 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Rods</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Cones</button></p>;
    const part3Bad = <p>Hmmm. Check the word bank for "rods" and see why this might not be the case.</p>;
    const part3Good = <p>Ding ding, correct! Cones help process much of this particular image for a few reasons: the image is in a photopic setting, the image has lots of color, and the image is processed in the central area of the field of vision.</p>;

    const part4 = <p><b>Now things get cellular and bit more confusing... so let's get things straight: we have two types of bipolar cells, both of which synapse with our aforementioned photoreceptors. Which type of bipolar cell receives input from central field of vision and is known for its high acuity? We focus on this one since our image is received by cones in the fovea.</b></p>;
    const question4 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Midget bipolar cells</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Diffuse bipolar cells</button></p>;
    const part4Bad = <p>This was a tough one, but this isn't right. Diffuse bipolar cells receive input from multiple photorecptors and is common in the periphery. It also has low acuity.</p>;
    const part4Good = <p>Yes! Midget bipolar cells are correct. Let's dig even deeper!</p>;

    const part5 = <p><b>Now the message has been transmitted from photoreceptors to bipolar cells, but there are more cells awaiting! Our apple image is transmitted to ganglion cells, but amacrine cells lie between which serve what role?</b></p>;
    const question5 = <p className="container"><button className="btn btn-block" onClick={() => this.props.addChoice('0')}>Lateral inhibition</button><button className="btn btn-block" onClick={() => this.props.addChoice('1')}>Contrast enhancement and temporal sensitivity</button></p>;
    const part5Bad = <p>This role is actually served by horizontal cells, which lie between photoreceptors and bipolar cells. Sorry!</p>;
    const part5Good = <p>Indeed; amacrine cells help detect light patterns that change over time. As our apple is picked off the tree, these cells will help detect the change in image!</p>;


    return(
      <p>
        {part0}
        {this.props.progress==0 && question0}
        {this.props.progress>=1 && (this.props.choices[0]==0 ? <p><i>Auditory pathway</i></p> : <p><i>Visual pathway</i></p>)}
        {this.props.progress>=1 && (this.props.choices[0]==1 ? part0Good : part0Bad)}

        {this.props.progress>=1 && (this.props.choices[0]==1 ? part1 : <p></p>)}
        {this.props.progress==1 && (this.props.choices[0]==1 ? question1 : <p>Game over.</p>)}
        {this.props.progress>=2 && (this.props.choices[1]==0 ? <p><i>Pupil</i></p> : <p><i>Cornea</i></p>)}
        {this.props.progress>=2 && (this.props.choices[1]==0 ? part1Good : part1Bad)}

        {this.props.progress>=2 && (this.props.choices[1]==0 ? part2 : <p></p>)}
        {this.props.progress==2 && (this.props.choices[1]==0 ? question2 : <p>Game over.</p>)}
        {this.props.progress>=3 && (this.props.choices[2]==0 ? <p><i>Retina</i></p> : <p><i>Vitreous humor</i></p>)}
        {this.props.progress>=3 && (this.props.choices[2]==0 ? part2Good : part2Bad)}

        {this.props.progress>=3 && (this.props.choices[2]==0 ? part3 : <p></p>)}
        {this.props.progress==3 && (this.props.choices[2]==0 ? question3 : <p>Game over.</p>)}
        {this.props.progress>=4 && (this.props.choices[3]==1 ? <p><i>Cones</i></p> : <p><i>Rods</i></p>)}
        {this.props.progress>=4 && (this.props.choices[3]==1 ? part3Good : part3Bad)}

        {this.props.progress>=4 && (this.props.choices[3]==1 ? part4 : <p></p>)}
        {this.props.progress==4 && (this.props.choices[3]==1 ? question4 : <p>Game over.</p>)}
        {this.props.progress>=5 && (this.props.choices[4]==0 ? <p><i>Midget bipolar cells</i></p> : <p><i>Diffuse bipolar cells</i></p>)}
        {this.props.progress>=5 && (this.props.choices[4]==0 ? part4Good : part4Bad)}

        {this.props.progress>=5 && (this.props.choices[4]==0 ? part5 : <p></p>)}
        {this.props.progress==5 && (this.props.choices[4]==0 ? question5 : <p>Game over.</p>)}
        {this.props.progress>=6 && (this.props.choices[5]==1 ? <p><i>Midget bipolar cells</i></p> : <p><i>Diffuse bipolar cells</i></p>)}
        {this.props.progress>=6 && (this.props.choices[5]==1 ? part5Good : part5Bad)}
      </p>
    )
  }
}


//Parent: Layout and Inventory Data
//Contains the story chapters
class Story extends React.Component{
  constructor(props){
    super(props);
    this.state={
      /* INDEX OF CHOICES:
      0: Start
      */
      choices: [],
      //Progress in general history
      chapter: 0,
      //To advance to the next paragraph.
      progress: 0,
      /*Determines the paragraphs that will appear next depending on your choices
      0: Start
      */
      path: 0,
      //For more complex branching
      subpath: 0,
      inventory: [
        //Name, Description
        ["Will to live", "Without this, you would be dead."]
      ],
      game: false
    };
	  this.startGame = this.startGame.bind(this);
    this.addChoice = this.addChoice.bind(this);
    this.renderIntro_Header = this.renderIntro_Header.bind(this);
    this.renderStory = this.renderStory.bind(this);
  }
  startGame(){
    this.setState({
      game: true
    })
  }
  addChoice(choiceMade){
    let cho = this.state.choices;
    cho.push(choiceMade)
    this.setState({choices: cho, progress: this.state.progress+1});
  }
  saveGame(){
    try{
      localStorage.chapter = this.state.chapter;
      localStorage.progress = this.state.progress;
      localStorage.path = this.state.path;
      localStorage.setItem('choices', JSON.stringify(this.state.choices));
      localStorage.setItem('inventory', JSON.stringify(this.state.inventory));
      alert('Game saved');
    }catch(e){
      alert('Something went wrong!' + e.error);
    }
  }
  loadGame(){
    let cho = JSON.parse(localStorage.getItem('choices'));
    let inv = JSON.parse(localStorage.getItem('inventory'));
    this.setState({
      game: true,
      chapter: localStorage.chapter,
      progress: localStorage.progress,
      path: localStorage.path,
      choices: cho,
      inventory: inv
    })
  }
  
  //Conditionals for rendering
  renderIntro_Header(){
    if(this.state.game==false){
      return(
            <header className="text-center bg-warning jumbotron">
              Sensory Pathway Project
            </header>
     )
    }
  }
  renderStory(){
    if(this.state.progress>=0){
      return(<ChapterOne addChoice={this.addChoice.bind(this)} progress={this.state.progress} choices={this.state.choices} path={this.state.path} subpath={this.state.subpath}/>);
    }
    // else if(this.state.progress>=2 & this.state.progress<=2){
    //   return(<ChapterTwo addChoice={this.addChoice.bind(this)} progress={this.state.progress} choices={this.state.choices} path={this.state.path} subpath={this.state.subpath}/>);
    // }
  }
  ///////////////////////////
  render(){
    return(
      <div>
	    {this.renderIntro_Header()}
      <div className="container-fluid">
        <div className="row">
          {
            this.state.game==true &&
            <nav className="col-3 px-1 bg-info rounded-right" id="sticky-sidebar">
              <HUD inventory={this.state.inventory} saveGame={this.saveGame.bind(this)} loadGame={this.loadGame.bind(this)}/>
            </nav>
          }
          <div className="col-1 col-sm-1 col-md-1 col-xl-1"></div>
          <main className={this.state.game==true ? "col-7 col-sm-7 col-md-7 col-xl-7 py-5" : "col-12 col-sm-12 col-md-12 col-xl-12"}>
            {
              this.state.game==true ?
                this.renderStory()
                :
                <p>Welcome to my Sensory Pathway Project.<br/><br/>
                  For this interactive game I've coded, you will simulate "being" a visual stimulus and track your progress from initial sensation to the final stages of interpretation! To play, simply answer the questions to try and correctly identify steps along the visual pathway. The word bank on the left will not provide the EXACT answers you need, but it will provide some helpful clues along the way! Click on any term to reveal more information. Finally, in this game, there are NO second chances! If you make a wrong selection, you'll have to refresh the page and start over! Get started below and good luck!
                   <br/><br/>
                   <center>
                    <button className="btn" onClick={() => this.startGame()}>Start game</button> <button className="btn" onClick={() => this.loadGame()}>Load Game</button>
                   </center>
                </p>
            }
          </main>
          <div className="col-1 col-sm-1 col-md-1 col-xl-1"></div>
        </div>
      </div>
	  </div>    
    )
  }
}



ReactDOM.render(<Story />, document.getElementById('container'));
	  </script>	
  </body>
</html>
